var _createClass=function(){function i(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,s){return t&&i(e.prototype,t),s&&i(e,s),e}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function a(o,r,l){function d(t,e){if(!r[t]){if(!o[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var n=r[t]={exports:{}};o[t][0].call(n.exports,function(e){return d(o[t][1][e]||e)},n,n.exports,a,o,r,l)}return r[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)d(l[e]);return d}({1:[function(e,t,s){function a(){var e=new Date;return e.setDate(e.getDate()+1),e.setHours(0,0,0,0),e}function i(e,t,s){var i,n;this.wrapper=e,this.onChanged=s.onChanged,this.dateFormat=s.dateFormat,this.setValue(t),this.startDate=a(),this.renderBounds=(i=a(),n=new Date(i.getFullYear(),i.getMonth()+12+1,0),{minDate:i,maxDate:n}),this.month=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],this.isManualChangedDate=!1,this.elems={items:this.wrapper.find(".months"),leftArrow:this.wrapper.find("button.left"),rightArrow:this.wrapper.find("button.right")},this.w_element=275,this.delta=46,this.availableDates=[],this.createHandlers()}i.prototype.setAvailableDates=function(e){this.availableDates=e,this.render()},i.prototype.setValue=function(e){this.date=e,this.curDate=this.makeDate(e)},i.prototype.setWidth=function(){this.w=this.wrapper.find(".wrapper").width(),this.minX=-this.elems.items.find(".month").length*this.w_element+this.w+this.delta},i.prototype.createHandlers=function(){var i=this;this.wrapper.on("click",".date",function(){$(".active",i.wrapper).removeClass("active"),$(this).addClass("active");var e=moment($(this).data("date"),i.dateFormat);i.setValue(e.toDate()),i.isManualChangedDate=!0,i.onChanged(i.curDate,i.isManualChangedDate)}),this.wrapper.on("click",".controls button",function(){var e=$(this).hasClass("right")?1:-1,t=Math.abs(parseFloat(i.elems.items.css("margin-left")))/i.w_element,s=Math.ceil(t);-1==e&&(s=Math.floor(t)),t===s&&(s+=e),i.scrollToMonth(s,!0)})},i.prototype.scrollToMonth=function(e,t){var s=-1*this.w_element*e;0<s?(this.elems.leftArrow.addClass("arr_offers__disabled"),this.elems.rightArrow.removeClass("arr_offers__disabled")):this.minX>s&&(this.elems.rightArrow.addClass("arr_offers__disabled"),this.elems.leftArrow.removeClass("arr_offers__disabled")),s=1<s?0:s<this.minX?this.minX:s,this.minX>s&&(s=this.minX);var i=this.elems.items;t?i.animate({marginLeft:s+"px"}):i.css("margin-left",s+"px")},i.prototype.scrollToSelectedDateMonth=function(){var e,t=this.renderBounds.minDate,s=this.renderBounds.maxDate,i=this.elems.items.find('.month[data-month="'+this.makeMonth(this.date)+'"]');0!==i.length&&(e=parseInt(i.data("index"),10),this.isSameMonth(this.date,s)&&!this.isSameMonth(this.date,t)&&--e,this.scrollToMonth(e,!1))},i.prototype.isSameMonth=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()},i.prototype.makeMonth=function(e){return e.getFullYear()+"."+(e.getMonth()+1)},i.prototype.makeDate=function(e){var t=e.getDate();return[t=("0"+t).slice(-2),("0"+(e.getMonth()+1)).slice(-2),e.getFullYear()].join(".")},i.prototype.render=function(){for(var e=this.renderBounds.minDate,t=this.renderBounds.maxDate,s=new Date(t.getFullYear(),t.getMonth()+1,1),i=new Date(e.getFullYear(),e.getMonth(),1),n="",a=0;n+=this.renderMonth(i.getMonth(),i.getFullYear(),a),a++,i=new Date(i.getFullYear(),i.getMonth()+1,1),!this.isSameMonth(i,s););this.elems.items.html(n),this.setWidth(),this.scrollToSelectedDateMonth()},i.prototype.renderMonth=function(e,t,s){var i="",n=new Date(t,e,1),a=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),o=new Date(n.getFullYear(),n.getMonth(),a).getDay(),r=new Date(n.getFullYear(),n.getMonth(),1).getDay(),l=new Date(n.getFullYear(),n.getMonth(),0).getDate(),d=void 0,u=void 0,h=void 0;i+='<div class="month" data-month="'+this.makeMonth(n)+'" data-index="'+s+'">',i+='<span class="month-name">'+this.month[n.getMonth()]+" "+n.getFullYear()+"</span>",i+="<table>",i+='<tr class="week-days">                <td>Пн</td>                <td>Вт</td>                <td>Ср</td>                <td>Чт</td>                <td>Пт</td>                <td class="output">Сб</td>                <td class="output">Вс</td>            </tr>',i+="<tr>";var c=void 0;if(0!==r)for(c=1;c<r;c++)i+='<td class="old unavailable_date">'+(d=l-r+c+1)+"</td>";else for(c=0;c<6;c++)i+='<td class="old unavailable_date">'+(d=l-5+c)+"</td>";for(c=1;c<=a;c++)u="date",(h=new Date(n.getFullYear(),n.getMonth(),c)).getMonth()===this.date.getMonth()&&h.getDate()===this.date.getDate()&&(u+=" active"),this.isDateAvailable(h)||(u+=" unavailable_date"),i+='<td class="'+u+'" data-date="'+this.makeDate(h)+'">'+c+"</td>",0===new Date(n.getFullYear(),n.getMonth(),c).getDay()&&(i+="</tr><tr>");if(0!==o)for(c=o;c<7;c++)d=c-o+1,h=new Date(n.getFullYear(),n.getMonth()+1,d),i+='<td class="old date unavailable_date" data-date="'+this.makeDate(h)+'">'+d+"</td>";return i+="</tr>",i+="</table>",i+="</div>"},i.prototype.isDateAvailable=function(e){var t=!0,s=this.makeDate(e);return(this.availableDates.length&&-1===this.availableDates.indexOf(s)||this.renderBounds.minDate.getTime()>e.getTime())&&(t=!1),t},t.exports=i},{}],2:[function(e,t,s){var i=e("../../../calendar/js/Calendar"),n=(_createClass(a,[{key:"init",value:function(){var s=this;this.$dropdown.find(".days input").prop("checked",this.values.softDates),this.calendar=new i(this.$dropdown.find(".calendar"),this.values.selectedDate,{onChanged:function(e,t){s.values.selectedDate=moment(e,s.MOMENT_DATE_FORMAT).toDate(),s.dispatchOnChange(t),s.hide()},dateFormat:this.MOMENT_DATE_FORMAT}),this.calendar.render(),this.attachHandlers()}},{key:"attachHandlers",value:function(){var t=this;$("input",this.$dropdown).on("change",function(e){t.values.softDates=!!$(e.currentTarget).prop("checked"),t.dispatchOnChange(!1)})}},{key:"setDate",value:function(e){this.values.selectedDate=e,this.calendar.setValue(e)}},{key:"setAvailableDates",value:function(e){this.calendar.setAvailableDates(e)}},{key:"isOpenedNow",value:function(){return this.$dropdown.hasClass("open")}},{key:"show",value:function(){this.$dropdown.addClass("open"),this.onAfterShow()}},{key:"hide",value:function(){this.$dropdown.removeClass("open")}},{key:"updateLabel",value:function(e){this.$dropdown.find(".date_field").text(e)}},{key:"dispatchOnChange",value:function(e){this.onChange(e)}}]),a);function a(e,t){_classCallCheck(this,a),this.$dropdown=e,this.onChange=t.onChange,this.onAfterShow=t.onAfterShow,this.MOMENT_DATE_FORMAT=t.MOMENT_DATE_FORMAT,this.values={softDates:t.values.isSoftDates,selectedDate:t.values.selectedDate},this.init()}window.findFormComponents=window.findFormComponents||{},window.findFormComponents.DateSelect=n},{"../../../calendar/js/Calendar":1}]},{},[2]),function a(o,r,l){function d(t,e){if(!r[t]){if(!o[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var n=r[t]={exports:{}};o[t][0].call(n.exports,function(e){return d(o[t][1][e]||e)},n,n.exports,a,o,r,l)}return r[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)d(l[e]);return d}({1:[function(e,t,s){function i(e){this.wrapper=e.wrapper,this.valueFrom=e.valueFrom,this.valueTo=e.valueTo,this.allowedValues=[1,2],this.onChange=e.onChange,this.cssClasses={wrapper:"nr-wrapper",item:"nr-item",selectedItemBound:"nr-item-bound",selectedItemFrom:"nr-item-left",selectedItemTo:"nr-item-right",selectedSingle:"nr-item-selected-single",selected:"nr-item-selected",hoveredSingle:"nr-item-hovered-single"},this.additionalItemCssClasses=[this.cssClasses.selectedItemBound,this.cssClasses.selectedItemFrom,this.cssClasses.selectedItemTo,this.cssClasses.selectedSingle,this.cssClasses.selected,this.cssClasses.hoveredSingle],this.setAllowedValues(e.values),this.createHandlers()}i.prototype.setAllowedValues=function(e){this.allowedValues=e,this.render()},i.prototype.getItemCssClasses=function(e,t){var s=[];return t.min===t.max&&e===t.min?s.push(this.cssClasses.selectedSingle):(e===t.min&&(s.push(this.cssClasses.selectedItemFrom),s.push(this.cssClasses.selectedItemBound)),e===t.max&&(s.push(this.cssClasses.selectedItemTo),s.push(this.cssClasses.selectedItemBound)),e>t.min&&e<t.max&&s.push(this.cssClasses.selected)),s},i.prototype.render=function(){for(var e,t="",s=0;s<this.allowedValues.length;s++)e=this.allowedValues[s],t+='<div class="'+[this.cssClasses.item].concat(this.getItemCssClasses(e,{min:this.valueFrom,max:this.valueTo})).join(" ")+'" data-value="'+e+'"><span>'+e+"</span></div>";this.wrapper.addClass(this.cssClasses.wrapper).html(t)},i.prototype.setValueFrom=function(e){this.valueFrom=e},i.prototype.setValueTo=function(e){this.valueTo=e},i.prototype.onItemClick=function(e){var t=!1;null!==this.valueTo?(this.setValueFrom(e),this.setValueTo(null),this.refreshSelected({min:e,max:e})):(e<this.valueFrom?(this.setValueTo(this.valueFrom),this.setValueFrom(e)):this.setValueTo(e),t=!0),this.onChange({min:this.valueFrom,max:this.valueTo},!0),t&&this.render()},i.prototype.refreshSelected=function(e){var t,s,i=this;this.wrapper.find("."+this.cssClasses.item).each(function(){t=i.getValueFromElem($(this)),s=i.getItemCssClasses(t,e),$(this).removeClass(i.additionalItemCssClasses.join(" ")),s.length&&$(this).addClass(s.join(" "))})},i.prototype.getValueFromElem=function(e){return parseInt(e.data("value"),10)},i.prototype.onMouseEnter=function(e){var t,s=this.getValueFromElem(e);e.addClass(this.cssClasses.hoveredSingle),null===this.valueTo&&(t={min:Math.min(this.valueFrom,s),max:Math.max(this.valueFrom,s)},this.refreshSelected(t))},i.prototype.onMouseLeave=function(e){e.removeClass(this.cssClasses.hoveredSingle)},i.prototype.createHandlers=function(){var t=this;this.wrapper.on("click","."+this.cssClasses.item,function(){var e=t.getValueFromElem($(this));t.onItemClick(e)}).on("mouseenter","."+this.cssClasses.item,function(e){e.preventDefault(),t.onMouseEnter($(this))}).on("mouseleave","."+this.cssClasses.item,function(e){e.preventDefault(),t.onMouseLeave($(this))})},t.exports=i},{}],2:[function(e,t,s){var n=e("../../../../include/number-range/_js/NumberRange"),i=(_createClass(a,[{key:"isOpenedNow",value:function(){return this.$dropdown.hasClass("open")}},{key:"show",value:function(){this.$dropdown.addClass("open")}},{key:"hide",value:function(){this.$dropdown.removeClass("open"),this.daysFrom===this.daysTo&&this.updateDaysChoiceState(),this.onHide()}},{key:"setValues",value:function(e,t,s){this.daysFrom=e,this.daysTo=t,this.days=s,this._updateNightsRange()}},{key:"updateSelectionTip",value:function(e){this.$dropdown.find(".info").html(e)}},{key:"_updateNightsRange",value:function(){0===this.days.length&&(this.days=this.defaultDays);var e={min:this.daysFrom,max:this.daysTo},t=!1;-1===this.days.indexOf(e.min)&&(t=!0,e.min=this.days[0]),-1===this.days.indexOf(e.max)&&(t=!0,1<this.days.length?e.max=this.days[1]:e.max=this.days[0]),t&&(this.daysFrom=Math.min(e.min,e.max),this.daysTo=Math.max(e.min,e.max)),this.daysChoice&&(this.updateDaysChoiceState(),t&&this.dispatchOnChange(!1))}},{key:"updateDaysChoiceState",value:function(){this.daysChoice.setValueFrom(this.daysFrom),this.daysChoice.setValueTo(this.daysTo),this.daysChoice.setAllowedValues(this.days)}},{key:"dispatchOnChange",value:function(e){this.onChange(e),this.allowAutoCloseOnChange=!0}},{key:"$label",get:function(){return this.$dropdown.find(".duration_field")}}]),a);function a(e,t){var s=this;_classCallCheck(this,a),this.$dropdown=e,this.defaultDays=[7,8,9,10,11,12,13,14,15,16],this.defaultDaysValue={from:8,to:10},this.daysFrom=this.defaultDaysValue.from,this.daysTo=this.defaultDaysValue.to,this.days=this.defaultDays,this.allowAutoCloseOnChange=!0,this.onChange=t.onChange,this.onHide=t.onHide;var i=t.values;this.setValues(i.daysFrom,i.daysTo,i.availableDays),this.daysChoice=new n({wrapper:this.$dropdown.find(".days"),values:this.defaultDays,valueFrom:this.daysFrom,valueTo:this.daysTo,onChange:function(e,t){s.daysFrom=e.min,null===e.max?(s.allowAutoCloseOnChange=!1,s.daysTo=e.min):s.daysTo=e.max,s.dispatchOnChange(t)}})}window.findFormComponents=window.findFormComponents||{},window.findFormComponents.DaysSelect=i},{"../../../../include/number-range/_js/NumberRange":1}]},{},[2]),function a(o,r,l){function d(t,e){if(!r[t]){if(!o[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var n=r[t]={exports:{}};o[t][0].call(n.exports,function(e){return d(o[t][1][e]||e)},n,n.exports,a,o,r,l)}return r[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)d(l[e]);return d}({1:[function(e,t,s){var i="country-region",d="only-hotels",H="country",A="region",u="hotel",n=(_createClass(a,[{key:"reset",value:function(){this.countryId=0,this.regionId=0,this.resetHotel()}},{key:"resetHotel",value:function(){this.selectedHotel=null}},{key:"set",value:function(e){this.reset(),this.departCityId=e.departCityId,this.countryId=e.countryId,this.regionId=e.regionId,e.selectedHotel&&(this.selectedHotel=e.selectedHotel)}}]),a);function a(e){_classCallCheck(this,a),this.reset(),this.departCityId=0,this.set(e)}var o=(_createClass(r,[{key:"attachHandlers",value:function(){var l=this;this.$dropdown.on("click",".destination-item",function(e){var t=$(e.currentTarget),s=t.data(),i=parseInt(s.city,10),n=parseInt(s.country,10),a=parseInt(s.value,10),o=s.type===H&&l._values.countryId!==n;switch(l._values.reset(),l._values.departCityId=i,l._values.countryId=n,s.type){case A:l._values.regionId=a;break;case u:l._values.selectedHotel={id:a,name:t.next("label").text().trim(),countryId:l._values.countryId}}var r=!1;(r=l.mode===d?!!l._values.selectedHotel:s.type!==H||!o)&&l.hide(),l.dispatchOnChange(!0),r&&l.onOpenNext()}),this.$dropdown.on("click",".remove",function(){l.resetSelection(!0)}),this.elements.$input.on("keyup",function(){l._onDestinationEnter(!1)})}},{key:"isOpenedNow",value:function(){return this.$dropdown.hasClass("open")}},{key:"setValues",value:function(e){this._values.set(e)}},{key:"setDepartCityId",value:function(e){this._values.departCityId=e}},{key:"getValues",value:function(){return this._values}},{key:"show",value:function(e){this.setValues(e),this.renderDestinationDropDown(),this.$dropdown.addClass("open");var t=this.elements.$input,s=this.$dropdown.find(".preloader");""===t.val()&&(t.attr("placeholder",""),s.removeClass("hidden"),setTimeout(function(){s.addClass("hidden"),t.attr("placeholder",t.data("hotel-placeholder")).focus()},500))}},{key:"hide",value:function(){this.$dropdown.removeClass("open");var e=this.elements.$input;e.attr("placeholder",e.data("preview")),this.renderFace(),this.mode===d?this._values.selectedHotel||this._hideDestinationResetButton():this._values.countryId||this._hideDestinationResetButton()}},{key:"renderFace",value:function(){var e="",t=!0;this.mode!==d||this._values.selectedHotel||(t=!1),this.mode===d||this.isHotelsSearchEnabled&&this._values.selectedHotel?this._values.selectedHotel&&(e=this._values.selectedHotel.name):this._values.regionId?e=this.data.getRegionName(this._values.countryId,this._values.regionId)+", "+this.data.getCountry(this._values.countryId).name:this._values.countryId?e=this.data.getCountry(this._values.countryId).name:t=!1,this.elements.$input.val(e),t?this._showDestinationResetButton():this._hideDestinationResetButton()}},{key:"_showDestinationResetButton",value:function(){this.$dropdown.find(".remove").removeClass("hidden")}},{key:"_hideDestinationResetButton",value:function(){this.$dropdown.find(".remove").addClass("hidden")}},{key:"renderDestinationDropDown",value:function(){var e,t,s;this._beforeRenderDestinationDropDown()&&(e="",e+=this._getCurrentDestinationHtml(),t=!1,this.mode!==d?this.isHotelsSearchEnabled&&this._values.selectedHotel||(this._values.countryId?(e+=this._getRegionsListHtml(),t=!0):e+=this._getCountriesListHtml()):""!==e||this.isAutocompleteSearch||(e=this._getVariantsHint(this._getHotelSearchLengthMessage())),s=this.$variantsWrapper,t&&s.scrollTop(0),s.html(e),this._afterRenderDestinationDropDown())}},{key:"_beforeRenderDestinationDropDown",value:function(){return this.$dropdown.find(".direction_dropdown > div > div").addClass("hidden"),this.$dropdown.find(".direction_loading").removeClass("hidden"),!(!this.data.isLoaded.data&&this.mode!==d&&(this.$variantsWrapper.html(this._getVariantsHint("Подождите, идет загрузка...")),1))}},{key:"_getVariantsHint",value:function(e){return"<p>"+e+"</p>"}},{key:"_afterRenderDestinationDropDown",value:function(){var e=this.$dropdown.find(".direction_loading");this.$dropdown.find(".direction_dropdown > div > div").removeClass("hidden"),e.addClass("hidden")}},{key:"_getCurrentDestinationHtml",value:function(){var e,t="",s=this._values,i=s.departCityId,n=s.countryId,a={name:"wsf-selected",is_active:!0,disabled:!1,title:"",type:"",depart_city_id:i,country_id:n,value:"",price:0,cur:""};return this.mode===d||s.selectedHotel&&this.isHotelsSearchEnabled?s.selectedHotel&&(a.type=u,a.title=s.selectedHotel.name,a.value=s.selectedHotel.id):s.regionId?(a.type=A,a.title=this.data.getRegionName(n,s.regionId)+", <span>"+this.data.getCountry(n).name+"</span>",a.value=s.regionId):n&&(e=this.data.getDirectionPrice(i,n),a.type=H,a.value=n,a.title=this.data.getCountry(n).name,a.price=e.value,a.cur=e.currency),""!==a.title&&(t+='<div class="direction_selected">'+this._getDirectionsItemHtml(a)+"</div>"),t}},{key:"_getCountriesListHtml",value:function(){var e="",t=this.data.getSortedDirections(this._values.departCityId);e+=this._getDirectionsHtml(t,"");var s=this.data.getOtherSortedDirections(this._values.departCityId);return e+=this._getDirectionsHtml(s,"Вылеты из других городов")}},{key:"_getDirectionsHtml",value:function(e,t){var s='<div class="direction_all">';""!==t&&(s+='<div class="header">'+t+"</div>"),s+="<ul>";for(var i=void 0,n=void 0,a=void 0,i=0;i<e.length;i++){var o=(n=e[i]).country.id,r=n.departCity.id;s+='<li class="direction_country">',a=this.data.getCountry(o).name,this._values.departCityId!==r&&(a+=" из "+this.data.getCity(r).nameFrom),s+=this._getDirectionsItemHtml({name:"wsf-country",type:H,is_active:this._values.countryId===o&&this._values.departCityId===r,title:a,depart_city_id:r,country_id:o,value:o,price:n.price,cur:n.currency,disabled:!1}),s+="</li>"}return s+="</ul></div>"}},{key:"_getRegionsListHtml",value:function(){var e,t,s,i="",n=this._values,a=n.departCityId,o=n.countryId,r=this.data.getSortedRegions(o);return 0!==r.length||this.data.isLoaded.nonPopularRegions?(i+='<div class="direction_popular"><ul><li class="direction_country">',e=this.data.getDirectionPrice(a,o),i+=this._getDirectionsItemHtml({name:"region",type:A,value:0,is_active:!1,depart_city_id:a,country_id:o,title:"Любой регион",disabled:!1,price:e.value,cur:e.currency}),i+="</li></ul></div>",t=r.slice(0,3),s=r.slice(3),t.length&&(i+='<div class="direction_popular">',i+='<div class="header">Популярные курорты</div><ul>',i+=this._getRegionItemsHtml(t),i+="</ul></div>"),s.length&&(i+='<div class="direction_popular">',i+='<div class="header">Остальные курорты</div><ul>',i+=this._getRegionItemsHtml(s),i+="</ul></div>")):(i="Подождите идет загрузка... ",this._loadRegions()),i}},{key:"_getRegionItemsHtml",value:function(e){for(var t="",s=void 0,i=this._values,n=i.departCityId,a=i.countryId,o=0;o<e.length;o++)s=e[o],t+='<li class="direction_country">',t+=this._getDirectionsItemHtml({name:"region",type:A,value:s.id,is_active:s.id===i.regionId,depart_city_id:n,country_id:a,title:s.name+", <span>"+this.data.getCountry(a).name+"</span>",disabled:!1,price:s.price,cur:s.cur}),t+="</li>";return t}},{key:"_getDirectionsItemHtml",value:function(e){var t=e.is_active?'checked="checked"':"",s="",i="";return 0!==e.price&&(i+='<div class="price">от '+window.utils.nfm(e.price)+" "+e.cur+"</div>"),s+='<div class="checkbox full-filling_checkbox"><input type="radio" class="destination-item" name="'+e.name+'" data-type="'+e.type+'" '+(e.disabled?"disabled ":"")+t+'data-city="'+e.depart_city_id+'" data-country="'+e.country_id+'" data-value="'+e.value+'"><label>'+e.title+i+"</label></div>"}},{key:"_loadRegions",value:function(){var e=this;this.isLoadRegionsStarted||(this.isLoadRegionsStarted=!0,this.data.isLoaded.nonPopularRegions||this.mode===d||this.data.loadRegions(function(){e.isAutocompleteSearch?e._onDestinationEnter(!0):e.renderDestinationDropDown()}))}},{key:"_onDestinationEnter",value:function(e){var t=this,s=0<arguments.length&&void 0!==e&&e;this.timers.input&&(clearTimeout(this.timers.input),this.timers.input=null),this.timers.input=setTimeout(function(){t._searchDestination(t.elements.$input.val().trim(),s)},this.debounceInputTime)}},{key:"_searchDestination",value:function(e,t){var s=this;if(""===(this.autocompleteLastSlug=e))return this.data.abortGetDestinationsRequest(),void this.resetSelection(!1);this._beforeRenderDestinationDropDown(),this._showDestinationResetButton(),this.isAutocompleteSearch=!0,this.data.isLoaded.nonPopularRegions||this._loadRegions(),t?this.lastResponseCache&&this.lastResponseCache.query===e&&this._onDestinationsResponse(this.lastResponseCache):(this.data.getDestinations(e,function(e){s._onDestinationsResponse(e)},this._values.countryId),this.$variantsWrapper.html(this._getVariantsHint("Идет поиск..."))),this._afterRenderDestinationDropDown()}},{key:"_onDestinationsResponse",value:function(e){if(!e.success)return this.renderDestinationDropDown(),!1;e.query;for(var t=(e=e.result).countries.length,s=e.regions.length,i=void 0,n=void 0,a=void 0,o=void 0,r={},i=0;i<t;i++)o=e.countries[i],this.data.countries.hasOwnProperty(o.id)&&(r[o.id]=1);var l={};for(i=0;i<s;i++)o=e.regions[i],this.data.isRegionExists(o.countryId,o.id)&&(l.hasOwnProperty(o.countryId)||(l[o.countryId]=[],r.hasOwnProperty(o.countryId)||(r[o.countryId]=0)),l[o.countryId].push(o.id));var d=[],u=[],h="wsf-destination",c=this._values.departCityId,v=void 0,p=void 0,m=void 0,f=void 0,g=void 0,y=void 0,C=void 0,w=void 0,_=void 0,D=void 0;for(v in r)if(v=Number(v),this.data.countries.hasOwnProperty(v)){if(_=r[v],p=this.data.countries[v],m=this.data.getSortedCountryDepartCities(p.departs,c),f=-1!==p.departs.indexOf(c),_)for(i=0;i<m.length;i++)g=m[i],y=this.data.getDirectionPrice(g,v),D={name:h,type:H,is_active:!1,title:p.name+" из "+this.data.cities[g].nameFrom,depart_city_id:g,country_id:v,value:v,price:y.value,cur:y.currency,disabled:!1,sort:p.sort},f?u.push(D):d.push(D);if(l.hasOwnProperty(v))for(n=0;n<l[v].length;n++)for(C=l[v][n],w=this.data.regions[v][C],a=0;a<m.length;a++)g=m[a],D={name:h,type:A,value:w.id,depart_city_id:g,country_id:v,title:w.name+" ("+p.name+") из "+this.data.cities[g].nameFrom,is_active:!1,disabled:!1,price:w.price,cur:w.cur,sort:p.sort},f?u.push(D):d.push(D)}u.sort(function(e,t){return e.sort-t.sort}),d.sort(function(e,t){return e.sort-t.sort});var S=u.concat(d),b="",k=!0;if(S.length){b+='<div class="direction_popular"><ul>';for(var I=0;I<S.length;I++)b+='<li class="direction_country">',b+=this._getDirectionsItemHtml(S[I]),b+="</li>";b+="</ul></div>"}else k=!1;var F,T,O=this._createHotelItems(e.hotels,h);if(O.length){b+='<div class="direction_popular hotel_list">',b+="<ul>";for(var $=0;$<O.length;$++)b+='<li class="direction_country">'+this._getDirectionsItemHtml(O[$])+"</li>";b+="</ul>",b+="</div>"}else k||(F='Не найдено совпадений по запросу "'+this.autocompleteLastSlug+'"',(T=this._getHotelSearchCountryId())&&(F+=" (Страна: "+this.data.getCountry(T).name+")"),b+=this._getVariantsHint(F));this.$variantsWrapper.html(b),this._afterRenderDestinationDropDown()}},{key:"_createHotelItems",value:function(e,t){for(var s=[],i=void 0,n=void 0,a=void 0,o=void 0,r=void 0,l=void 0,i=0;i<e.length;i++)n=e[i],a=parseInt(n.countryId,10),this.data.isCountryExists(a)&&(r=-1!==this.data.countries[a].departs.indexOf(this._values.departCityId),l=n.name,r?o=this._values.departCityId:(o=this.data.countries[a].departs[0],l+=" из "+this.data.getCity(o).nameFrom),s.push({name:t,type:u,value:n.id,depart_city_id:o,country_id:a,title:l,is_active:!1,disabled:!1,price:0,cur:""}));return s}},{key:"_getHotelSearchCountryId",value:function(){var e=0;return this.mode===d&&this._values.countryId&&(e=this._values.countryId),e}},{key:"_compare",value:function(e,t){return-1!==e.toLowerCase().indexOf(t.toLowerCase())}},{key:"resetSelection",value:function(e){this.mode===d?this._values.resetHotel():this._values.reset(),this._hideDestinationResetButton(),this.isAutocompleteSearch=!1,this.lastResponseCache=null,this.dispatchOnChange(e)}},{key:"_getHotelSearchLengthMessage",value:function(){return"Введите хотя бы "+this.hotelSearchMinLength+" символа"}},{key:"dispatchOnChange",value:function(e){this.isAutocompleteSearch=!1,this.lastResponseCache=null,this.onChange(e)}},{key:"$variantsWrapper",get:function(){return this.$dropdown.find(".direction_dropdown div")}}]),r);function r(e,t,s){_classCallCheck(this,r),this.$dropdown=e,this.data=t,this.onChange=s.onChange,this.onOpenNext=s.onOpenNext||null,this.mode=s.mode,this.elements={$input:this.$dropdown.find(".direction_field"),$title:this.$dropdown.find(".form-title")},this.isHotelsSearchEnabled=this.mode!==i,this.isDestinationSearchEnabled=this.mode!==d,this.isAutocompleteSearch=!1,this.lastResponseCache=null,this.hotelSearchMinLength=3,this.debounceInputTime=300,this.autocompleteLastSlug="",this.timers={input:null},this._values=new n(s.values),this.attachHandlers()}window.findFormComponents=window.findFormComponents||{},window.findFormComponents.destination={Select:o,modeList:{ALL:"all",COUNTRY_REGION:i,HOTELS:d}}},{}]},{},[1]),function a(o,r,l){function d(t,e){if(!r[t]){if(!o[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var n=r[t]={exports:{}};o[t][0].call(n.exports,function(e){return d(o[t][1][e]||e)},n,n.exports,a,o,r,l)}return r[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)d(l[e]);return d}({1:[function(e,t,s){var i=(_createClass(n,[{key:"init",value:function(e,t){this.value=e,this._renderItems(t),this._attachHandlersOnce()}},{key:"isOpenedNow",value:function(){return this.$dropdown.hasClass("open")}},{key:"show",value:function(){this.$dropdown.addClass("open")}},{key:"hide",value:function(){this.$dropdown.removeClass("open")}},{key:"_renderItems",value:function(e){var t="";for(var s in e)t+='<div class="form-dropdown_item" data-value="'+s+'">'+e[s]+"</div>";""!==t&&this.$dropdown.find(".form_dropdown_menu").html(t),this.setValue(this.value,!1)}},{key:"_attachHandlersOnce",value:function(){var s=this;this.$dropdown.on("click",".form-dropdown_item",function(e){var t=$(e.currentTarget).data("value");s.setValue(t,!0,!0),s.hide()})}},{key:"setValue",value:function(e,t,s){var i,n=1<arguments.length&&void 0!==t&&t,a=2<arguments.length&&void 0!==s&&s,o=this.$dropdown.find('.form-dropdown_item[data-value="'+e+'"]');o.length?(i=this.value!=e,this.value=e,this.$dropdown.find("."+this.selectedCssClass).removeClass(this.selectedCssClass),o.addClass(this.selectedCssClass),this.elements.$label.html(this._getLabel(o)),(i||a)&&this.dispatchOnChange(n)):console.warn("value %s not found",e)}},{key:"_getLabel",value:function(e){return this.getLabel?this.getLabel(this.value):e.html()+(this.showLabelCaret?'<span class="caret"></span>':"")}},{key:"dispatchOnChange",value:function(e){this.onChange(e)}}]),n);function n(e,t){_classCallCheck(this,n),this.$dropdown=e,this.elements={$label:this.$dropdown.find(t.labelSelector)},this.onChange=t.onChange,this.getLabel=t.getLabel||null,this.value=t.value,this.showLabelCaret=t.showLabelCaret||!1,this.selectedCssClass="form-dropdown_item__selected"}window.findFormComponents=window.findFormComponents||{},window.findFormComponents.SearchFormDropdown=i},{}]},{},[1]),function a(o,r,l){function d(t,e){if(!r[t]){if(!o[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var n=r[t]={exports:{}};o[t][0].call(n.exports,function(e){return d(o[t][1][e]||e)},n,n.exports,a,o,r,l)}return r[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)d(l[e]);return d}({1:[function(e,t,s){function i(e,t,s,i){this.wrapper=e,this.bounds=t,this.onChange=i,this.setValue(s,!1),this.createHandlers()}i.prototype.createHandlers=function(){var t=this;$("button",this.wrapper).on("click",function(){var e=$(this).hasClass("next")?1:-1;t.changeValue(e)})},i.prototype.changeValue=function(e){var t=this.getValue()+e;t<this.bounds.min||t>this.bounds.max||this.setValue(t,!0)},i.prototype.setValue=function(e,t){this.wrapper.find("span").text(e),this.wrapper.find(".next, .prev").removeClass("disable"),e+1>this.bounds.max&&this.wrapper.find(".next").addClass("disable"),e-1<this.bounds.min&&this.wrapper.find(".prev").addClass("disable"),this.onChange(e,t)},i.prototype.getValue=function(){return parseInt(this.wrapper.find("span").text(),10)},t.exports=i},{}],2:[function(e,t,s){var i=e("../../../../include/counter/_js/Counter"),n=(_createClass(a,[{key:"isOpenedNow",value:function(){return this.$dropdown.hasClass("open")}},{key:"show",value:function(){this.$dropdown.addClass("open")}},{key:"hide",value:function(){this.$dropdown.removeClass("open")}},{key:"updateLabel",value:function(e){this.$dropdown.find(".tourists_field").text(e)}},{key:"attachHandlersOnce",value:function(){var n=this,e=$(".ages input",this.$dropdown);e.on("change",function(){var i=[];e.removeClass("danger"),e.each(function(e,t){var s=$(t).val();""!==s&&(s>n.bounds.childrenAges.max?$(n).addClass("danger"):i.push(parseInt(s,10)))}),n.values.childAges=i,n.dispatchOnChange(!0)})}},{key:"onChangeAdultCount",value:function(e,t){this.values.adult=e,this.dispatchOnChange(t)}},{key:"onChangeChildrenCount",value:function(e,t){this.values.child=e,this.updateChildAges(),this.dispatchOnChange(t)}},{key:"updateChildAges",value:function(){var i=this,e=this.$dropdown.find(".ages"),t=e.find("input");t.addClass("hidden"),e.addClass("hidden");var n=0;t.each(function(e,t){var s;n<i.values.child&&($(t).removeClass("hidden"),((s=i.values.childAges[n])<i.bounds.childrenAges.min||s>i.bounds.childrenAges.max)&&(s=""),$(t).val(s)),n++}),0<this.values.child&&e.removeClass("hidden")}},{key:"dispatchOnChange",value:function(e){this.onChange(e)}}]),a);function a(e,t){var s=this;_classCallCheck(this,a),this.$dropdown=e,this.onChange=t.onChange,this.bounds={adults:{min:1,max:10},children:{min:0,max:4},childrenAges:{min:0,max:15}},this.values={adult:t.values.adult,child:t.values.child,childAges:t.values.childAges},this.adults=new i($(".adults-count",this.$dropdown),this.bounds.adults,this.values.adult,function(e,t){s.onChangeAdultCount(e,t)}),this.children=new i($(".children-count",this.$dropdown),this.bounds.children,this.values.child,function(e,t){s.onChangeChildrenCount(e,t)}),this.updateChildAges(),this.attachHandlersOnce()}window.findFormComponents=window.findFormComponents||{},window.findFormComponents.TouristsSelect=n},{"../../../../include/counter/_js/Counter":1}]},{},[2]),function a(o,r,l){function d(t,e){if(!r[t]){if(!o[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var n=r[t]={exports:{}};o[t][0].call(n.exports,function(e){return d(o[t][1][e]||e)},n,n.exports,a,o,r,l)}return r[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)d(l[e]);return d}({1:[function(e,t,s){var i=e("../../include/SearchFormData"),n="hotel",a=e("../../include/SearchFormValues"),o=a.SearchFormValues,r=a.STARS_ANY,l=a.MOMENT_DATE_FORMAT,d=(_createClass(u,[{key:"processValues",value:function(){return this.data.isCityExists(this.values.departCityId)||this.values.setDefaultDepartCity(),this.values.countryId&&!this.data.isDirectionAvailable(this.values.departCityId,this.values.countryId)&&this.values.resetDestination(),this.mode!==n||this.values.countryId?(this.setHiddenValue(this.hiddenElemNames.city,this.values.departCityId),this._setDestinationInputValues(),!0):(this.destroy(),!1)}},{key:"destroy",value:function(){$(".short-search").remove(),window.dispatchEvent(new CustomEvent("searchForm.destroyed"))}},{key:"init",value:function(){this.initControls(),this.bindFormHandlersOnce(),this.bindSearchEventsSubscribes(),this.values.countryId&&this.destinationSelect.renderFace(),this.destinationSelect.isOpenedNow()&&(this.destinationSelect.setValues(this.values),this.destinationSelect.renderDestinationDropDown()),this.updateDaysRange(),this.$main.find(".short-search_body").removeClass("loading"),this.setHiddenValue(this.hiddenElemNames.search,1),this.values.isStartOnCurrentPage()&&this.triggerFormSubmit()}},{key:"initControls",value:function(){this.$main=$(".short-search"),this.elements.$progressbar=$(".search-progressbar",this.$main),this.citySelect=null,this.destinationSelect=null,this.dateSelect=null,this.daysSelect=null,this.starsSelect=null,this.touristsSelect=null,this.initCitiesSelect(),this.initDestinationSelect(),this.initDaysSelect(),this.initDateSelect(),this.initStarsSelect(),this.initTouristsSelect()}},{key:"bindFormHandlersOnce",value:function(){var a=this;$(".body_form",this.$main).on("click",".form-title",function(e){var t=$(e.currentTarget).closest(".form_dropdown");switch(t.data("type")){case"destination":a.destinationSelect.isOpenedNow()||a.destinationSelect.show(a.values);break;case"date":a.dateSelect.isOpenedNow()?a.dateSelect.hide():a.dateSelect.show();break;case"duration":a.daysSelect.isOpenedNow()?a.daysSelect.hide():a.daysSelect.show();break;case"depart-city":case"stars":case"tourists":t.toggleClass("open")}}),$("body").on("click",function(e){var t,s,i,n=a.$main.find(".form_dropdown.open");n.length&&(""!==(i=0===(s=(t=$(e.target)).closest(".form_dropdown")).length?t.hasClass("destination-item")?"destination":"":s.data("type"))&&(n=n.not('[data-type="'+i+'"]')),n.each(function(e,t){switch(t.getAttribute("data-type")){case"destination":a.destinationSelect.isOpenedNow()&&a.destinationSelect.hide(a.values);break;case"duration":a.daysSelect.hide();break;case"date":case"depart-city":case"stars":case"tourists":$(t).removeClass("open")}}))}).on("click",".change-search-params",function(e){e.preventDefault();var t=$(e.currentTarget).data("target")||"destination";switch(t){case"date":a.dateSelect.show();break;case"destination":a.destinationSelect.show(a.values);break;case"days":a.daysSelect.show();break;case"tourists":a.touristsSelect.show();break;default:console.warn("Unknown target for change search params",t)}}),$(window).on("onLocation",function(e,t){a.isChanged.departCity||a.data.isCityExists(t.depart_id)&&a.citySelect.setValue(t.depart_id,!1)}),$(".form_search",this.$main).on("submit",function(e){return!!a.onSubmit()&&(a.values.isStartOnCurrentPage()?(e.preventDefault(),a.dispatchStartNewSearchEvent()):$("#w-st-findtours").html("Идет поиск "+img_load),!0)}),$("#repeatCurrentSearch").on("click",function(){a.triggerFormSubmit()})}},{key:"initCitiesSelect",value:function(){var t=this;this.citySelect=new window.findFormComponents.SearchFormDropdown(this.$main.find(".form_from"),{value:this.values.departCityId,labelSelector:".form-title .from_field",showLabelCaret:!1,getLabel:function(e){return"Из "+t.data.getCity(e).nameFrom},onChange:function(e){t.values.departCityId=parseInt(t.citySelect.value,10),t.setHiddenValue(t.hiddenElemNames.city,t.values.departCityId),t.destinationSelect.setDepartCityId(t.values.departCityId),t.values.countryId&&(t.data.isDirectionAvailable(t.values.departCityId,t.values.countryId)?t._onAfterDirectionChange():t.destinationSelect.resetSelection(!1)),e&&(t.isChanged.departCity=!0,!t.allowAutoOpenNext||t.values.countryId&&t.isChanged.destination||setTimeout(function(){t.destinationSelect.show(t.values)},t.debounceTime))}});var e={},s=void 0;for(var i in this.data.cities)this.data.cities.hasOwnProperty(i)&&(s=this.data.cities[i],e[i]=s.nameFrom);this.citySelect.init(this.values.departCityId,e)}},{key:"initDestinationSelect",value:function(){var t=this,e=window.findFormComponents.destination.modeList,s=this.$main.find(".form_hotel");this.destinationSelect=new window.findFormComponents.destination.Select(this.$main.find(".form_direction"),this.data,{values:this.values,mode:s.length?e.COUNTRY_REGION:e.ALL,onChange:function(e){e&&(t.isChanged.destination=!0),t._onDestinationChange()},onOpenNext:function(){t.allowAutoOpenNext&&!t.isChanged.date&&setTimeout(function(){t.dateSelect.show()},t.debounceTime)}})}},{key:"_onDestinationChange",value:function(){var e=this.destinationSelect.getValues(),t=this.values.countryId!==e.countryId;this.values.countryId=e.countryId,this.values.regionId=e.regionId,e.departCityId&&this.values.departCityId!==e.departCityId&&this.citySelect.setValue(e.departCityId,!1),this.values.resetHotel(),e.selectedHotel&&this.values.setSelectedHotel(e.selectedHotel.id,e.selectedHotel.name,e.selectedHotel.countryId),this.destinationSelect.renderFace(),this.destinationSelect.isOpenedNow()&&this.destinationSelect.renderDestinationDropDown(),this._setDestinationInputValues(),t&&this._onAfterDirectionChange()}},{key:"_setDestinationInputValues",value:function(){this.setHiddenValue(this.hiddenElemNames.country,this.values.countryId),this.setHiddenValue(this.hiddenElemNames.region,this.values.regionId),this.setHiddenValue(this.hiddenElemNames.hotel,this.values.getSelectedHotelsId().join(","))}},{key:"initDateSelect",value:function(){var i=this;this.dateSelect=new window.findFormComponents.DateSelect(this.$main.find(".form_date"),{values:this.values,MOMENT_DATE_FORMAT:l,onChange:function(e){var t=i.dateSelect.values;i.values.selectedDate=t.selectedDate,i.values.isSoftDates=t.softDates;var s=i.values.dateRange;i.setHiddenValue(i.hiddenElemNames.dateFrom,i.values.getDateAsValue(s.from)),i.setHiddenValue(i.hiddenElemNames.dateTo,i.values.getDateAsValue(s.to)),i.isChanged.date=e,i.allowAutoOpenNext&&e&&!i.isChanged.nightsRange&&setTimeout(function(){i.daysSelect.show()},i.debounceTime),i._renderDepartDateLabel()},onAfterShow:function(){i.refreshDateSelectCalendar()}}),this._renderDepartDateLabel()}},{key:"initDaysSelect",value:function(){var t=this;this.daysSelect=new window.findFormComponents.DaysSelect(this.$main.find(".form_duration"),{onChange:function(e){t.values.nightsFrom=t.daysSelect.daysFrom-1,t.values.nightsTo=t.daysSelect.daysTo-1,t.setHiddenValue(t.hiddenElemNames.nightsFrom,t.values.nightsFrom),t.setHiddenValue(t.hiddenElemNames.nightsTo,t.values.nightsTo),e?(t.isChanged.nightsRange=!0,t.daysSelect.allowAutoCloseOnChange&&(t.daysSelect.hide(),setTimeout(function(){t.values.selectedHotel?t.allowAutoOpenNext&&!t.isChanged.tourists&&t.touristsSelect.show():t.allowAutoOpenNext&&!t.isChanged.stars&&t.starsSelect.show()},t.debounceTime))):t.isChanged.nightsRange&&t.showTooltip(t.daysSelect.$dropdown,"К сожалению выбранный диапазон дней недоступен по данному направлению",3500),t._renderNightsLabel()},onHide:function(){t._renderNightsLabel()},values:this._getDaysRangeCurrentValues()}),this._renderNightsLabel()}},{key:"initStarsSelect",value:function(){var s=this;this.starsSelect=new window.findFormComponents.SearchFormDropdown(this.$main.find(".form_stars"),{value:this.values.stars,labelSelector:".form-title .stars_field",showLabelCaret:!1,onChange:function(e){e&&(s.isChanged.stars=!0);var t=s.starsSelect.value;s.values.stars=t===r?t:parseInt(t,10),s.setHiddenValue(s.hiddenElemNames.stars,s.values.stars),s.starsSelect.hide(),s.allowAutoOpenNext&&e&&!s.isChanged.tourists&&setTimeout(function(){s.touristsSelect.show()},s.debounceTime)}}),this.starsSelect.init(this.values.stars,{})}},{key:"initTouristsSelect",value:function(){var s=this;this.touristsSelect=new window.findFormComponents.TouristsSelect(this.$main.find(".form_tourists"),{onChange:function(e){var t;s.touristsSelect&&(e&&(s.isChanged.tourists=!0),t=s.touristsSelect.values,s.values.adult=t.adult,s.values.child=t.child,s.values.childAges=t.childAges,s.setHiddenValue(s.hiddenElemNames.adults,s.values.adult),s.setHiddenValue(s.hiddenElemNames.children,s.values.child),s.setHiddenValue(s.hiddenElemNames.ages,s.values.childAges.join(",")),s._renderTouristsLabel())},values:this.values}),this._renderTouristsLabel()}},{key:"updateDaysRange",value:function(){var e=this._getDaysRangeCurrentValues();this.daysSelect.setValues(e.daysFrom,e.daysTo,e.availableDays)}},{key:"_getDaysRangeCurrentValues",value:function(){var e=[];return this.values.countryId&&(e=this.data.getDirectionDays(this.values.departCityId,this.values.countryId)),{daysFrom:this.values.nightsFrom+1,daysTo:this.values.nightsTo+1,availableDays:e}}},{key:"_renderDepartDateLabel",value:function(){this.dateSelect.updateLabel(this.getDepartDateLabel()),this._updateDaysSelectTip()}},{key:"_renderTouristsLabel",value:function(){var e=this.values.adult+" взр";0<this.values.child&&(e+=", "+this.values.child+" дет"),this.touristsSelect.updateLabel(e)}},{key:"_renderNightsLabel",value:function(){this.daysSelect.$label.html(this.getDaysLabel()),this._updateDaysSelectTip()}},{key:"_updateDaysSelectTip",value:function(){this.daysSelect.updateSelectionTip("Выбраны даты <b>"+this.getDepartDateLabel()+"</b> "+this.getDaysLabel())}},{key:"_onAfterDirectionChange",value:function(){this.updateDaysRange(),this.refreshDateSelectCalendar()}},{key:"refreshDateSelectCalendar",value:function(){var e,t,s=this,i=!0,n=[],a=null;this.values.countryId&&(e=this.values.departCityId,t=this.values.countryId,this.data.isDatesLoaded(e,t)?(n=this.data.getDates(e,t)).length&&-1===n.indexOf(this.values.getSelectedDateAsValue())&&(this.isChanged.date&&this.showTooltip(this.dateSelect.$dropdown,"К сожалению на выбранную вами дату нет вылетов по данному направлению, поэтому мы изменили дату вылета на ближайшую возможную",3500),a=moment(n[0],l).toDate(),this.dateSelect.setDate(a)):(this.data.loadDates(e,t,function(){s.refreshDateSelectCalendar()}),i=!1)),i&&this.dateSelect.setAvailableDates(n),null!==a&&this.dateSelect.dispatchOnChange(!1)}},{key:"showTooltip",value:function(e,t,s){var i=2<arguments.length&&void 0!==s?s:3500,n=e.find(".form-title"),a=this.$main.hasClass("fixed")?"bottom":"top";n.bootstrapTooltip({trigger:"manual",placement:a,title:t}).bootstrapTooltip("show"),setTimeout(function(){n.bootstrapTooltip("hide")},i)}},{key:"setHiddenValue",value:function(e,t){$("#"+e).val(t)}},{key:"validateForm",value:function(){var e,t=!0;return this.values.countryId||(t=!1,this.showTooltip(this.destinationSelect.$dropdown,"Выберите куда вы хотите поехать",2500)),0<this.values.child&&this.values.childAges.length<this.values.child&&(t=!1,e=this.touristsSelect.bounds.childrenAges,this.showTooltip(this.touristsSelect.$dropdown,"Возврат детей должен быть от "+e.min+" до "+e.max+" лет",2500)),t}},{key:"onSubmit",value:function(){return this.validateForm()?(console.log("submit success"),!0):(console.log("submit fail"),!1)}},{key:"getValues",value:function(){return this.values}},{key:"getDaysLabel",value:function(){var e=this.values.nightsFrom+1,t=this.values.nightsTo+1;return e===t?this.daysSelect.isOpenedNow()?"на "+e+"-?? дней ":"на "+t+" "+window.utils.getnoun(t,"день","дня","дней"):"на "+e+"-"+t+" "+window.utils.getnoun(t,"день","дня","дней")}},{key:"getDepartDateLabel",value:function(){var e=this.values.getSelectedDateAsValue(),t=this.values.isSoftDates?"D MMM":"D MMMM",s=new moment(e,l).format(t);return this.values.isSoftDates&&(s+=" ± 3 дня"),s}},{key:"dispatchStartNewSearchEvent",value:function(){var e=this.values.getSearchQuery(),t=this.data.cities[e.departCity],s=this.data.countries[e.country],i=new CustomEvent("startNewSearch",{detail:{formParams:e,country:{name2:s.nameTo},departCity:{name2:t.nameFrom}}});window.dispatchEvent(i)}},{key:"bindSearchEventsSubscribes",value:function(){var i=this;$(window).on("search.startMain",function(e,t){i.updateProgress(0)}).on("search.chunk",function(e,t,s){i.updateProgress(t.search.progress)}).on("search.end",function(e,t){i.updateProgress(100)}),window.addEventListener("searchByHotel",function(e){var t=e.detail.hotel;i.values.resetDestination(),i.values.countryId=t.countryId,i.values.setSelectedHotel(t.id,t.name,t.countryId),i.destinationSelect.setValues(i.values),i._onDestinationChange(),i.triggerFormSubmit()}),window.addEventListener("repeatSearch",function(){i.triggerFormSubmit()})}},{key:"triggerFormSubmit",value:function(){$(".form_search",this.$main).submit()}},{key:"updateProgress",value:function(e){var t,s;this.elements.$progressbar&&this.elements.$progressbar.length&&(t=$(".body_form").width()-$(".form_search").width(),s=Math.ceil(t*e/100),this.elements.$progressbar.css("width",s+"px"))}}]),u);function u(e){var t=this;_classCallCheck(this,u),this.values=new o(e.values),this.data=new i(e.data),this.mode="mode"in e?e.mode:"",this.isChanged={departCity:!1,nightsRange:!1,date:!1,destination:!1,tourists:!1,stars:!1},this.allowAutoOpenNext=!0,this.hiddenElemNames={city:"wsf-city",country:"wsf-country",region:"wsf-region",hotel:"wsf-hotel",dateFrom:"wsf-date-from",dateTo:"wsf-date-to",nightsFrom:"wsf-nights-from",nightsTo:"wsf-nights-to",adults:"wsf-adults",children:"wsf-children",ages:"wsf-ages",stars:"wsf-stars",search:"wsf-search"},this.elements={$progressbar:null},this.debounceTime=12;var s=null;this.mode===n&&this.values.countryId&&(s=this.values.countryId),this.data.load(function(){t.processValues()?t.init():t.destroy()},s)}window.WideSearchForm=d},{"../../include/SearchFormData":2,"../../include/SearchFormValues":3}],2:[function(e,t,s){var i=e("../../../../include/find-form/_js/BaseSearchFormData"),n=(_inherits(a,i),a);function a(e){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e))}t.exports=n},{"../../../../include/find-form/_js/BaseSearchFormData":4}],3:[function(e,t,s){var i=e("../../../../include/find-form/_js/BaseSearchFormValues"),n=i.BaseSearchFormValues,a=i.STARS_ANY,o=i.MOMENT_DATE_FORMAT,r=(_inherits(l,n),_createClass(l,[{key:"getSelectedDateAsValue",value:function(){return this.getDateAsValue(this.selectedDate)}}]),l);function l(e){return _classCallCheck(this,l),_possibleConstructorReturn(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e))}t.exports={SearchFormValues:r,STARS_ANY:a,MOMENT_DATE_FORMAT:o}},{"../../../../include/find-form/_js/BaseSearchFormValues":5}],4:[function(e,t,s){var i=(_createClass(n,[{key:"getMealsIdByName",value:function(e){if(jQuery.isEmptyObject(this.meals.listByName))for(var t=0;t<this.meals.list.length;t++)this.meals.listByName[this.meals.list[t].name]=Number(this.meals.list[t].id);for(var s=[],i=0;i<e.length;i++)this.meals.listByName.hasOwnProperty(e[i])&&s.push(this.meals.listByName[e[i]]);return s}},{key:"load",value:function(e,t){var s,i=this,n=1<arguments.length&&void 0!==t?t:null;this.isLoaded.data?e():(this.loading.data.onLoad=e,(this.loading.nonPopularRegions.started=!0)!==this.loading.data.started&&(this.loading.data.started=!0,s=this.urls.getData,n&&(s+="?countryId="+encodeURIComponent(n)),$.getJSON(s,{},function(e){i.cities=e.cities,i.countries=e.countries,i.directions=e.directions,i.meals.list=e.meals,i.regions=e.regions,i.isLoaded.data=!0,i.isLoaded.nonPopularRegions=!0,i.loading.data.onLoad(),"function"==typeof i.loading.nonPopularRegions.onLoad&&i.loading.nonPopularRegions.onLoad()})))}},{key:"loadRegions",value:function(){}},{key:"_addRegions",value:function(e){if(e){var t=void 0;for(t in e)e.hasOwnProperty(t)&&(this.regions[t]=e[t])}}},{key:"getSortedCities",value:function(){var e=[],t=void 0;for(var s in this.cities)this.cities.hasOwnProperty(s)&&(t=this.cities[s],e.push({id:s,name:t.name,nameFrom:t.nameFrom,sort:t.sort}));return e.sort(function(e,t){return e.sort-t.sort})}},{key:"getSortedCountryDepartCities",value:function(e,s){return e.sort(function(e,t){return t===s?1:0}),e}},{key:"isDatesLoaded",value:function(e,t){return e in this.availableDates&&t in this.availableDates[e]}},{key:"loadDates",value:function(e,t,s){var i=this;$.getJSON(this.urls.getDates,{depart_city_id:e,country_id:t},function(e){i.availableDates.hasOwnProperty(e.depart_city_id)||(i.availableDates[e.depart_city_id]={}),i.availableDates[e.depart_city_id][e.country_id]=e.dates,s()}).fail(function(){s()})}},{key:"getDates",value:function(e,t){return this.isDatesLoaded(e,t)?this.availableDates[e][t]:[]}},{key:"getSortedSplitDirections",value:function(e){var t=this.getSortedDirections(e);return{popular:t.slice(0,6),other:t.slice(6)}}},{key:"getOtherSortedDirections",value:function(e){var t,s=[];for(var i in this.directions)this.directions.hasOwnProperty(i)&&(i=parseInt(i,10),Number(i)!==e&&(t=this.getCityDirections(i),s=s.concat(this._prepareCityDirectionsForSort(i,t))));return n._sortDirections(s)}},{key:"getSortedDirections",value:function(e){var t=this.getCityDirections(e);return n._sortDirections(this._prepareCityDirectionsForSort(e,t))}},{key:"_prepareCityDirectionsForSort",value:function(e,t){var s=void 0,i=void 0,n=[];for(i in t)t.hasOwnProperty(i)&&(s=t[i],n.push({departCity:{id:e},country:{id:parseInt(i,10),name:this.countries[i].name,code:this.countries[i].code},sort:this.countries[i].sort,price:s.price||0,currency:s.cur||""}));return n}},{key:"getCityDirections",value:function(e){return this.directions[e]||{}}},{key:"isCityExists",value:function(e){return e in this.cities}},{key:"getCity",value:function(e){var t=this.isCityExists(e)?this.cities[e]:null;return{name:t?t.name:"N/A",nameFrom:t?t.nameFrom:"N/A"}}},{key:"isCountryExists",value:function(e){return e in this.countries}},{key:"getCountry",value:function(e){var t=this.isCountryExists(e)?this.countries[e]:null;return{name:t?t.name:"N/A",nameTo:t?t.nameTo:"N/A",to:t?t.to:"в",sort:t?t.sort:0,departCitiesId:t?t.departs:[]}}},{key:"isRegionExists",value:function(e,t){return this.regions.hasOwnProperty(e)&&this.regions[e].hasOwnProperty(t)}},{key:"getRegionName",value:function(e,t){var s="";return this.isRegionExists(e,t)&&(s=this.regions[e][t].name),s}},{key:"getDirectionPrice",value:function(e,t){var s=this.isDirectionAvailable(e,t);return{value:s?this.directions[e][t].price:0,currency:s?this.directions[e][t].cur:""}}},{key:"isDirectionAvailable",value:function(e,t){return this.directions.hasOwnProperty(e)&&this.directions[e].hasOwnProperty(t)}},{key:"getDirectionDays",value:function(e,t){var s=[];return this.isDirectionAvailable(e,t)&&(s=this.directions[e][t].days),s.sort(function(e,t){return e-t})}},{key:"abortGetDestinationsRequest",value:function(){this.timers.getDestinationsRequest&&(this.timers.getDestinationsRequest.abort(),this.timers.getDestinationsRequest=null),this.timers.getHotelsCall&&clearInterval(this.timers.getHotelsCall)}},{key:"getDestinations",value:function(e,t,s){var i=this;this.abortGetDestinationsRequest();var n={query:e,limit:20};s&&(n.countryId=s),this.timers.getHotelsCall=setTimeout(function(){i.timers.getDestinationsRequest=$.getJSON(i.urls.getDestinations,n,function(e){t(e)})},100)}},{key:"getSortedRegions",value:function(e){var t=[];if(e in this.regions)for(var s in this.regions[e])this.regions[e].hasOwnProperty(s)&&t.push(this.regions[e][s]);return t.length&&t.sort(function(e,t){return t.popularity-e.popularity}),t}}],[{key:"_sortDirections",value:function(e){return e.sort(function(e,t){return e.sort-t.sort}),e}}]),n);function n(e){_classCallCheck(this,n),this.urls={getData:e.urls.getData,getRegions:e.urls.getRegions,getDestinations:e.urls.getDestinations,getDates:e.urls.getDates},this.isLoaded={data:!1,nonPopularRegions:!1},this.loading={data:{started:!1,onLoad:null},nonPopularRegions:{started:!1,onLoad:null}},this.cities=e.cities||{},this.countries=e.countries||{},this.regions=e.regions||{},this.directions=e.directions||{},e.directions&&(this.isLoaded.data=!0,this.isLoaded.nonPopularRegions=!0),this.availableDates={},this.meals={list:e.meals||[],listByName:{}},this.timers={getDestinationsRequest:null,getHotelsCall:0}}t.exports=i},{}],5:[function(e,t,s){var i=0,n=(_createClass(a,[{key:"setSelectedHotel",value:function(e,t,s){this.selectedHotel={id:Number(e),name:t,countryId:Number(s)}}},{key:"resetHotel",value:function(){this.selectedHotel=null}},{key:"setDefaultDepartCity",value:function(){this.departCityId=1}},{key:"resetDestination",value:function(){this.countryId=0,this.regionId=0,this.resetHotel()}},{key:"getDateAsValue",value:function(e){return("0"+e.getDate()).slice(-2)+"."+("0"+(e.getMonth()+1)).slice(-2)+"."+e.getFullYear()}},{key:"getSelectedHotelsId",value:function(){var e=[];return this.selectedHotel&&e.push(this.selectedHotel.id),e}},{key:"getSearchQuery",value:function(){var e=Object.assign({},this);e.hotelIds=this.getSelectedHotelsId(),e.stars=e.stars===i?0:e.stars;var t=this.dateRange;return e.dateFrom=t.from,e.dateTo=t.to,e.combined=this.combined,e.mealIds.length&&(e.mealIds=this.mealIds),e.child&&(e.childAges=e.childAges.slice(0,this.child)),new window.search.Query(e)}},{key:"isStartOnCurrentPage",value:function(){return this.search}},{key:"dateRange",get:function(){var e=this.selectedDate.getDate(),t=this.isSoftDates?this.rangeDays:0;return{from:new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth(),e-t),to:new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth(),e+t)}}}]),a);function a(e){_classCallCheck(this,a),this.departCityId=parseInt(e.departCityId,10),this.countryId=parseInt(e.countryId,10)||0,this.regionId=parseInt(e.regionId,10)||0;var t=e.selectedDate.split(".");this.selectedDate=new Date(t[2],t[1]-1,t[0]),this.isSoftDates=!!e.isSoftDates,this.rangeDays=3,this.nightsFrom=parseInt(e.nightsFrom,10),this.nightsTo=parseInt(e.nightsTo,10),this.adult=parseInt(e.adult,10),this.child=parseInt(e.child,10),this.childAges=e.childAges,this.stars=e.stars===i?i:parseInt(e.stars,10),this.selectedHotel=e.selectedHotel,this.mealIds=e.mealIds,this.search=!!e.search,this.combined=e.combined}t.exports={BaseSearchFormValues:n,STARS_ANY:i,MOMENT_DATE_FORMAT:"DD.MM.YYYY"}},{}]},{},[1]);
//# sourceMappingURL=form.min.js.map
