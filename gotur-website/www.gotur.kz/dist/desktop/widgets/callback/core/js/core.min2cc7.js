var _createClass=function(){function l(e,a){for(var t=0;t<a.length;t++){var l=a[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(e,a,t){return a&&l(e.prototype,a),t&&l(e,t),e}}();function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}!function i(n,r,o){function c(a,e){if(!r[a]){if(!n[a]){var t="function"==typeof require&&require;if(!e&&t)return t(a,!0);if(u)return u(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var s=r[a]={exports:{}};n[a][0].call(s.exports,function(e){return c(n[a][1][e]||e)},s,s.exports,i,n,r,o)}return r[a].exports}for(var u="function"==typeof require&&require,e=0;e<o.length;e++)c(o[e]);return c}({1:[function(e,a,t){var o=e("../../../../../include/_js/callback/callback-request"),c=e("../../../../../include/_js/callback/working-time").isWorkingTimeNow,u=window;function m(){_classCallCheck(this,m)}(_createClass(m,null,[{key:"init",value:function(){m.bindGeneralEventListeners(),m.bindSpecificEventListeners()}},{key:"bindSpecificEventListeners",value:function(){$("#show-emerge-callback").one("click",function(e){e.preventDefault(),e.stopPropagation(),$(".emerge-callback-form").addClass("active"),$(this).html("Отправить").addClass("callback-form-submit analytic-event").data("event","callbackFloating.create")});var e=!1;$(window).on("scroll",window.utils.throttle(function(){300<$(this).scrollTop()?e||(e=!0,$("#emerge-callback-form").addClass("show-callback")):e&&(e=!1,$("#emerge-callback-form").removeClass("show-callback"))},150)),$(".show-nauryz-callback-form").on("click",function(){m.showCallbackPopupFormNauryz()})}},{key:"bindGeneralEventListeners",value:function(){$("body").on("click",".callback-form-submit",function(e){e.preventDefault();var a=$(this),t=a.closest(".callback-form");if(t.length){var l=a.data("formType")||"",s=t.find(".callback-result-wrap"),i=m.buildFormParams(t),n=t.find(".callback-widget-phone").closest(".form-group");if(!i.isChooseCallTime&&!c())return n.removeClass("has-error"),void m.showCallbackPopupForm(i);i.validate()?(n.removeClass("has-error"),m.toggleSubmitButton(a,!1),s.html(u.getMessageTemplate("loading")).removeClass("hidden"),t.addClass("state-result"),o.create(i,function(e){m.toggleSubmitButton(a,!0),m.showResultMessage({$form:t,$resultField:s,response:e,isDelayed:i.isChooseCallTime,formType:l})})):i.haveError(i.errorFields.PHONE)&&n.addClass("has-error")}}).on("click",".callback-choose-time button",function(){var e=$(this),a=e.data("time");e.parent().find(".active").removeClass("active"),e.addClass("active"),$(".callback-widget-delayed-time").val(a)}).on("click",".open-callback-popup",function(){m.showCallbackPopupForm()}).on("click",".close",function(){var e=$(this).closest(".alert");e.hasClass("alert-success")&&m.clearForm(),e.remove()})}},{key:"buildFormParams",value:function(e){var a,t,l=e.find(".callback-widget-city_id"),s=e.find(".callback-widget-form_type_id"),i=e.find(".callback-widget-phone"),n={cityId:l.val(),formTypeId:s.val(),phone:i.val().trim(),isChooseCallTime:0},r=e.find(".callback-widget-name");return r.length&&(n.clientName=r.val()),parseInt(e.find(".callback-widget-is-choose-time").val(),10)&&(n.isChooseCallTime=1,a=e.find(".callback-widget-delayed-date"),t=e.find(".callback-widget-delayed-time"),n.callDate=a.length?a.val():"",n.callTime=t.length?t.val():""),new o.Params(n)}},{key:"toggleSubmitButton",value:function(e,a){e.prop("disabled",!a).toggleClass("disabled",!a)}},{key:"getResponseMessageHtml",value:function(e,a,t){return(2<arguments.length&&void 0!==t?t:"")+'\n            <div class="block-title">'+(e=e.toUpperCase())+'</div>\n            <div class="block-hint">'+a+"</div>"}},{key:"getResultMessageImageHtml",value:function(e,a){var t="";return(t="short"===a?"":e?"/img/night-time.png":"/img/france-woman.png")?'<img src="'+t+'">':""}},{key:"showResultMessage",value:function(e){var a=e.$form,t=e.$resultField,l=e.response,s=e.isDelayed,i=e.formType,n=l.title.toUpperCase()+"!",r="",r=l.success?1===a.closest("#bspopup").length?($(".callback-on-working, .callback-night-time, .callback-inputs",a).addClass("hidden"),m.getResponseMessageHtml(n,l.message,m.getResultMessageImageHtml(s,i))):u.getMessageTemplate("success",m.getResponseMessageHtml(n,l.message)):u.getMessageTemplate("error",m.getResponseMessageHtml(n,l.message));t.html(r),a.addClass("state-result")}},{key:"showCallbackPopupForm",value:function(e){var a=0<arguments.length&&void 0!==e?e:null,t=$("#callback-form-popup").html();m.renderCallbackForm(t,a)}},{key:"showCallbackPopupFormNauryz",value:function(e){var a=0<arguments.length&&void 0!==e?e:null,t=$("#callback-nauryz").html();m.renderCallbackForm(t,a,720)}},{key:"renderCallbackForm",value:function(e,a,t){var l=1<arguments.length&&void 0!==a?a:null,s=2<arguments.length&&void 0!==t?t:530,i=c();u.bs3popup({content:e,width:s,setLock:!0});var n,r=$("#bspopup"),o=$(".callback-form",r);i?(o.find(".callback-on-working").removeClass("hidden"),o.find(".callback-night-time").addClass("hidden"),o.find(".callback-widget-is-choose-time").val(0)):(o.find(".callback-night-time").removeClass("hidden"),o.find(".callback-on-working").addClass("hidden"),o.find(".callback-widget-is-choose-time").val(1)),o.removeClass("state-result"),$(".phone-mask",r).mask("+7(999)999-99-99"),l&&($(".callback-widget-phone").val(l.phone),(n=o.find(".callback-widget-form_type_id")).val(l.formTypeId||n.data("default"))),m.clearForm(),u.bs3popup("show")}},{key:"clearForm",value:function(){var e=$(".emerge-callback-form");e.find(".callback-widget-name").val(""),e.find(".callback-widget-phone").val("")}}]),m).init()},{"../../../../../include/_js/callback/callback-request":5,"../../../../../include/_js/callback/working-time":6}],2:[function(e,a,t){var l="phone",s="dateTime",i=window;var n=(_createClass(r,[{key:"setYMConversionEvent",value:function(e){this.ymConversionEvent=e}},{key:"setGAConversionEvent",value:function(e,a){e&&e&&(this.gaConversionEvent={category:e,action:a})}},{key:"validate",value:function(){var e=!0;return!this.isChooseCallTime||""!==this.callDate&&""!==this.callTime&&-1!==parseInt(this.callTime,10)||(e=!1,this._addError(s,"Выберите время звонка")),10!==(""+this.phone).trim().replace("+7","").replace(/\D/g,"").length&&(e=!1,this._addError(l,"Проверьте номер телефона")),e}},{key:"haveError",value:function(e){return this.errorList[e].error}},{key:"_addError",value:function(e,a){if(!this.errorList.hasOwnProperty(e))return!1;this.errorList[e].error=!0,this.errorList[e].message=a}},{key:"errorFields",get:function(){return{PHONE:l,DATETIME:s}}},{key:"error",get:function(){var e={field:"",message:""};return this.errorList.phone.error?(e.field=l,e.message=this.errorList.phone.message):this.errorList.dateTime.error&&(e.field=s,e.message=this.errorList.dateTime.message),e}}],[{key:"loadForm",value:function(e){var a={};for(var t in e){var l=e[t];a[l.name]=l.value}return new r(a)}}]),r);function r(e){_classCallCheck(this,r),this.srcId=i.app.src_id?i.app.src_id:null,this.vUid=i.app.v_uid?i.app.v_uid:"",this.clientName=e.hasOwnProperty("clientName")?e.clientName:"",this.cityId=parseInt(e.cityId,10),this.formTypeId=parseInt(e.formTypeId,10),this.phone=e.phone,this.isChooseCallTime=e.hasOwnProperty("isChooseCallTime")?parseInt(e.isChooseCallTime,10):0,this.callDate="",this.callTime="",this.isChooseCallTime&&(this.callDate=e.callDate,this.callTime=e.callTime),this.requestId="requestId"in e?Number(e.requestId):null,this.ymConversionEvent="",e.ymConversionEvent&&this.setYMConversionEvent(e.ymConversionEvent),this.gaConversionEvent=null,e.hasOwnProperty("gaConversionEventCategory")&&e.hasOwnProperty("gaConversionEventAction")&&this.setGAConversionEvent(e.gaConversionEventCategory,e.gaConversionEventAction),this.errorList={},this.errorList[l]={error:!1,message:""},this.errorList[s]={error:!1,message:""}}a.exports=n},{}],3:[function(e,a,t){a.exports=function(e,a){var t={phone:e.phone,cityId:e.cityId,requestId:e.requestId,callDate:e.callDate,callTime:e.callTime},l={success:!1,title:"Ошибка",message:""};$.post(window.app.urls.changeCallbackCallTime,t,function(e){l.success=e.success,l.callDateTimeDescription=e.callDateTimeDescription,l.success?(l.title="Спасибо",l.message="Мы перезвоним "+e.callDateTimeDescription):(l.title="Ошибка",l.message="Не удалось изменить время звонка. Извините за неудобства"),a(l)},"json")}},{}],4:[function(e,a,t){function n(e){_classCallCheck(this,n),this.id=e.id,this.callDate=e.callDate,this.callTime=e.callTime,this.callDateTimeDescription=e.callDateTimeDescription,this.allowChangeCallTime=e.allowChangeCallTime}function r(){_classCallCheck(this,r),this.success=!1,this.title="",this.message="",this.request=null,this.callTimes=null,this.selectedCallTime=""}a.exports=function(t,l){var s,i=new r;t.validate()?((s={srcId:t.srcId,vUid:t.vUid,cityId:t.cityId,formTypeId:t.formTypeId,phone:t.phone,isChooseCallTime:t.isChooseCallTime}).isChooseCallTime&&(s.callDate=t.callDate,s.callTime=t.callTime),t.clientName&&(s.clientName=t.clientName),$.post(window.app.urls.addCallback,s,function(e){var a;if(e.success)i.success=!0,i.title="Спасибо",i.request=new n(e.request),i.callTimes=e.callTimes,i.selectedCallTime=e.selectedCallTime,s.isChooseCallTime?i.message="Наш менеджер свяжется с вами в указанное время":i.message="Наш менеджер свяжется с вами в ближайшее время",window.tracking.setEvent("callback.create"),$("body").trigger("callback:success"),t.ymConversionEvent&&window.tracking.setYaEvent(t.ymConversionEvent),t.gaConversionEvent&&(a=t.gaConversionEvent,window.tracking.setGAEvent(a.category,a.action));else switch(i.title="Ошибка",e.errorType){case"not_working_time":i.message="К сожалению, рабочий день окончен";break;case"non_correct_data":i.message="Введены некорректные данные";break;default:i.message="Извините, произошла ошибка. Попробуйте позднее"}l(i)},"json")):l(i)}},{}],5:[function(e,a,t){var l=e("./CallbackParams"),s=e("./callback-request-create-fn"),i=e("./callback-request-change-call-time-fn");a.exports={Params:l,create:s,changeCallTime:i}},{"./CallbackParams":2,"./callback-request-change-call-time-fn":3,"./callback-request-create-fn":4}],6:[function(e,a,t){a.exports={isWorkingTimeNow:function(){if(window.app.debug)return!1;var e=new Date,a=e.getHours(),t=function(e){var a=e.getDay();if(0===a)return null;var t={from:10,to:19};return 6===a&&(t.to=15),t}(e);if(null===t)return!1;var l=a<t.from,s=a>=t.to;return!(l||s)}}},{}]},{},[1]);
//# sourceMappingURL=core.min.js.map
